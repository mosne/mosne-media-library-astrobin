(()=>{"use strict";const e=window.wp.i18n;if("undefined"!=typeof wp){const r=(r,a=null)=>{const t=`<a href="https://app.astrobin.com/i/${r.hash}" target="_blank" rel="nofollow noreferrer">${r.title}</a> ${(0,e.__)("by","mosne-media-library-astronomy")} <a href="https://app.astrobin.com/u/${r.user}" target="_blank" rel="nofollow noreferrer">${r.user}</a> &copy; <a href="${r.license_url}" target="_blank" rel="nofollow noreferrer">${r.license_name}</a>\n    `;return a?`${t}<br/><em>${(0,e.__)("Image of the Day:","mosne-media-library-astronomy")} ${a}</em>`:t},a=e=>{if(!e)return null;try{return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch(r){return e}},t=e=>({sourceId:e.id,id:void 0,title:e.title||"",hash:e.hash||"",caption:r(e,e.date?a(e.date):null),previewUrl:e.url_regular,url:e.url_real||e.url_hd}),s=async(e={},r,a="term")=>{try{const s={...e,limit:30,type:r},o={per_page:"page_size",search:a,page:"page"};let n="/astrobin/search";r.startsWith("nasa_")&&(n="/nasa/search");const i=new URL(`${mosneAstronomy.apiUrl}${n}`);Object.entries(s).forEach((([e,r])=>{const a=o[e]||e;null!=r&&i.searchParams.set(a,r)}));const m="imageoftheday"===r?"IOTD":r,y=await window.fetch(i,{credentials:"same-origin",headers:{"X-WP-Nonce":mosneAstronomy.nonce}});if(!y.ok){console.error(`${m} API error:`,y.status,y.statusText);const e=await y.text();return console.error("Error details:",e),[]}const l=(await y.json()).objects||[];return 0===l.length?(console.error(`No ${m} results found`),[]):l.map(t)}catch(e){return console.error(`Error fetching ${r}:`,e),[]}},o=(e,r,a,t={})=>{const{type:o,searchParam:n}={type:e.replace("astrobin-",""),searchParam:"term",...t};wp.data.dispatch("core/block-editor").registerInserterMediaCategory({name:e,labels:{name:r,search_items:a},mediaType:"image",fetch:async(e={})=>s(e,o,n)})};o("astrobin-my-pictures",(0,e.__)("AstroBin | My Pictures","mosne-media-library-astronomy"),(0,e.__)("Search by title","mosne-media-library-astronomy"),{type:"astrobin_my_pictures"}),o("astrobin-public-pictures",(0,e.__)("AstroBin | Public Pictures","mosne-media-library-astronomy"),(0,e.__)("Search by title","mosne-media-library-astronomy"),{type:"astrobin_public_pictures"}),o("astrobin-other-user-gallery",(0,e.__)("AstroBin | By Username","mosne-media-library-astronomy"),(0,e.__)("Search by username","mosne-media-library-astronomy"),{type:"astrobin_user_gallery",searchParam:"username"}),o("astrobin-by-subject",(0,e.__)("AstroBin | By Subject","mosne-media-library-astronomy"),(0,e.__)("Search by subject","mosne-media-library-astronomy"),{type:"astrobin_by_subject"}),o("astrobin-by-hash",(0,e.__)("AstroBin | By Image Hash","mosne-media-library-astronomy"),(0,e.__)("Search by hash (ID)","mosne-media-library-astronomy"),{type:"astrobin_by_hash"}),o("astrobin-image-of-the-day",(0,e.__)("AstroBin | Image of the Day","mosne-media-library-astronomy"),(0,e.__)("Browse past images","mosne-media-library-astronomy"),{type:"astrobin_imageoftheday"}),o("nasa-image-of-the-day",(0,e.__)("NASA | Image of the Day","mosne-media-library-astronomy"),(0,e.__)("Browse past images","mosne-media-library-astronomy"),{type:"nasa_imageoftheday"}),o("nasa-planetary",(0,e.__)("NASA | Planetary","mosne-media-library-astronomy"),(0,e.__)("Browse past images","mosne-media-library-astronomy"),{type:"nasa_planetary"}),o("nasa-mars",(0,e.__)("NASA | Mars","mosne-media-library-astronomy"),(0,e.__)("Browse past images","mosne-media-library-astronomy"),{type:"nasa_mars"})}})();