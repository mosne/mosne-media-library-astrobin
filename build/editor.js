(()=>{"use strict";const e=window.wp.i18n;if("undefined"!=typeof wp){const r=(r,t=null)=>{const a=`<a href="https://app.astrobin.com/i/${r.hash}" target="_blank" rel="nofollow noreferrer">${r.title}</a> ${(0,e.__)("by","mosne-astrobin")} <a href="https://app.astrobin.com/u/${r.user}" target="_blank" rel="nofollow noreferrer">${r.user}</a> &copy; <a href="${r.license_url}" target="_blank" rel="nofollow noreferrer">${r.license_name}</a>\n    `;return t?`${a}<br/><em>${(0,e.__)("Image of the Day:","mosne-astrobin")} ${t}</em>`:a},t=e=>{if(!e)return null;try{return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch(r){return e}},a=e=>({sourceId:e.id,id:void 0,title:e.title||"",hash:e.hash||"",caption:r(e,e.date?t(e.date):null),previewUrl:e.url_regular,url:e.url_real||e.url_hd}),s=async(e={},r,t="term")=>{try{const s={...e,limit:30,type:r},o={per_page:"page_size",search:t,page:"page"},n=new URL(`${mosneAstroBin.apiUrl}/search`);Object.entries(s).forEach((([e,r])=>{const t=o[e]||e;null!=r&&n.searchParams.set(t,r)}));const i="imageoftheday"===r?"IOTD":r,c=await window.fetch(n,{credentials:"same-origin",headers:{"X-WP-Nonce":mosneAstroBin.nonce}});if(!c.ok){console.error(`${i} API error:`,c.status,c.statusText);const e=await c.text();return console.error("Error details:",e),[]}const l=(await c.json()).objects||[];return 0===l.length?(console.error(`No ${i} results found`),[]):l.map(a)}catch(e){return console.error(`Error fetching ${r}:`,e),[]}},o=(e,r,t,a={})=>{const{type:o,searchParam:n}={type:e.replace("astrobin-",""),searchParam:"term",...a};wp.data.dispatch("core/block-editor").registerInserterMediaCategory({name:e,labels:{name:r,search_items:t},mediaType:"image",fetch:async(e={})=>s(e,o,n),getReportUrl:({sourceId:e})=>`https://www.astrobin.com/api/v1/image/${e}/`,isExternalResource:!0})};o("astrobin-my-pictures",(0,e.__)("AstroBin | My Pictures","mosne-astrobin"),(0,e.__)("Search by title","mosne-astrobin"),{type:"my_pictures"}),o("astrobin-public-pictures",(0,e.__)("AstroBin | Public Pictures","mosne-astrobin"),(0,e.__)("Search by title","mosne-astrobin"),{type:"public_pictures"}),o("astrobin-other-user-gallery",(0,e.__)("AstroBin | By Username","mosne-astrobin"),(0,e.__)("Search by username","mosne-astrobin"),{type:"user_gallery",searchParam:"username"}),o("astrobin-by-subject",(0,e.__)("AstroBin | By Subject","mosne-astrobin"),(0,e.__)("Search by subject","mosne-astrobin"),{type:"by_subject"}),o("astrobin-by-hash",(0,e.__)("AstroBin | By Image Hash","mosne-astrobin"),(0,e.__)("Search by hash (ID)","mosne-astrobin"),{type:"by_hash"}),o("astrobin-image-of-the-day",(0,e.__)("AstroBin | Image of the Day","mosne-astrobin"),(0,e.__)("Browse past images","mosne-astrobin"),{type:"imageoftheday"})}})();