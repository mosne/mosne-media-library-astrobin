{"version":3,"file":"editor.js","mappings":"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","sources":["webpack://mosne-media-library-astrobin/external window [\"wp\",\"i18n\"]","webpack://mosne-media-library-astrobin/webpack/bootstrap","webpack://mosne-media-library-astrobin/webpack/runtime/compat get default export","webpack://mosne-media-library-astrobin/webpack/runtime/define property getters","webpack://mosne-media-library-astrobin/webpack/runtime/hasOwnProperty shorthand","webpack://mosne-media-library-astrobin/webpack/runtime/make namespace object","webpack://mosne-media-library-astrobin/./src/editor.js"],"sourcesContent":["module.exports = window[\"wp\"][\"i18n\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { __ } from \"@wordpress/i18n\";\n\nif (typeof wp !== \"undefined\") {\n  // Helper functions to reduce duplication\n  const createAstrobinCaption = (result, formattedDate = null) => {\n    const baseCaption = `<a href=\"https://app.astrobin.com/i/${\n      result.hash\n    }\" target=\"_blank\" rel=\"nofollow\">${result.title}</a> ${__(\n      \"by\",\n      \"mosne-astrobin\"\n    )} <a href=\"https://app.astrobin.com/u/${\n      result.user\n    }\" target=\"_blank\" rel=\"nofollow\">${result.user}</a>`;\n\n    if (formattedDate) {\n      return `${baseCaption}<br/><em>${__(\n        \"Image of the Day:\",\n        \"mosne-astrobin\"\n      )} ${formattedDate}</em>`;\n    }\n\n    return baseCaption;\n  };\n\n  const formatDate = (dateString) => {\n    if (!dateString) return null;\n\n    try {\n      const dateObj = new Date(dateString);\n      return dateObj.toLocaleDateString(undefined, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n      });\n    } catch (e) {\n      return dateString;\n    }\n  };\n\n  const mapToMediaItem = (result) => ({\n    sourceId: result.id,\n    id: undefined,\n    title: result.title || \"\",\n    hash: result.hash || \"\",\n    caption: createAstrobinCaption(\n      result,\n      result.date ? formatDate(result.date) : null\n    ),\n    previewUrl: result.url_regular,\n    url: result.url_real || result.url_hd,\n  });\n\n  // Shared fetch function to reduce code duplication\n  const fetchAstrobinImages = async (\n    query = {},\n    type,\n    searchParam = \"term\"\n  ) => {\n    try {\n      const defaultArgs = {\n        limit: 50,\n        type: type,\n      };\n\n      const finalQuery = { ...query, ...defaultArgs };\n      const mapFromInserterMediaRequest = {\n        per_page: \"page_size\",\n        search: searchParam,\n        page: \"page\",\n      };\n\n      const url = new URL(`${mosneAstroBin.apiUrl}/search`);\n      Object.entries(finalQuery).forEach(([key, value]) => {\n        const queryKey = mapFromInserterMediaRequest[key] || key;\n        if (value !== undefined && value !== null) {\n          url.searchParams.set(queryKey, value);\n        }\n      });\n\n      const logPrefix = type === \"imageoftheday\" ? \"IOTD\" : type;\n     \n      const response = await window.fetch(url, {\n        credentials: \"same-origin\",\n        headers: {\n          \"X-WP-Nonce\": mosneAstroBin.nonce,\n        },\n      });\n\n      if (!response.ok) {\n        console.error(\n          `${logPrefix} API error:`,\n          response.status,\n          response.statusText\n        );\n        const errorText = await response.text();\n        console.error(\"Error details:\", errorText);\n        return [];\n      }\n\n      const jsonResponse = await response.json();\n      const results = jsonResponse.objects || [];\n\n      if (results.length === 0) {\n        console.error(`No ${logPrefix} results found`);\n        return [];\n      }\n\n      return results.map(mapToMediaItem);\n    } catch (error) {\n      console.error(`Error fetching ${type}:`, error);\n      return [];\n    }\n  };\n\n  // Register media categories with less duplicate code\n  const registerAstrobinCategory = (\n    name,\n    displayName,\n    searchHint,\n    fetchOptions = {}\n  ) => {\n    const { type, searchParam } = {\n      type: name.replace(\"astrobin-\", \"\"),\n      searchParam: \"term\",\n      ...fetchOptions,\n    };\n\n    wp.data.dispatch(\"core/block-editor\").registerInserterMediaCategory({\n      name,\n      labels: {\n        name: displayName,\n        search_items: searchHint,\n      },\n      mediaType: \"image\",\n      async fetch(query = {}) {\n        return fetchAstrobinImages(query, type, searchParam);\n      },\n      getReportUrl: ({ sourceId }) =>\n        `https://www.astrobin.com/api/v1/image/${sourceId}/`,\n      isExternalResource: true,\n    });\n  };\n\n  // Register all AstroBin media categories\n  registerAstrobinCategory(\n    \"astrobin-my-pictures\",\n    __(\"AstroBin | My Pictures\", \"mosne-astrobin\"),\n    __(\"Search by title\", \"mosne-astrobin\"),\n    { type: \"my_pictures\" }\n  );\n\n  registerAstrobinCategory(\n    \"astrobin-public-pictures\",\n    __(\"AstroBin | Public Pictures\", \"mosne-astrobin\"),\n    __(\"Search by title\", \"mosne-astrobin\"),\n    { type: \"public_pictures\" }\n  );\n\n  registerAstrobinCategory(\n    \"astrobin-other-user-gallery\",\n    __(\"AstroBin | By Username\", \"mosne-astrobin\"),\n    __(\"Search by username\", \"mosne-astrobin\"),\n    { type: \"user_gallery\", searchParam: \"username\" }\n  );\n\n  registerAstrobinCategory(\n    \"astrobin-by-subject\",\n    __(\"AstroBin | By Subject\", \"mosne-astrobin\"),\n    __(\"Search by subject (e.g. M31)\", \"mosne-astrobin\"),\n    { type: \"by_subject\" }\n  );\n\n  registerAstrobinCategory(\n    \"astrobin-image-of-the-day\",\n    __(\"AstroBin | Image of the Day\", \"mosne-astrobin\"),\n    __(\"Browse past images\", \"mosne-astrobin\"),\n    { type: \"imageoftheday\" }\n  );\n}\n"],"names":["__","wp","createAstrobinCaption","result","formattedDate","baseCaption","hash","title","user","formatDate","dateString","dateObj","Date","toLocaleDateString","undefined","year","month","day","e","mapToMediaItem","sourceId","id","caption","date","previewUrl","url_regular","url","url_real","url_hd","fetchAstrobinImages","query","type","searchParam","defaultArgs","limit","finalQuery","mapFromInserterMediaRequest","per_page","search","page","URL","mosneAstroBin","apiUrl","Object","entries","forEach","key","value","queryKey","searchParams","set","logPrefix","response","window","fetch","credentials","headers","nonce","ok","console","error","status","statusText","errorText","text","jsonResponse","json","results","objects","length","map","registerAstrobinCategory","name","displayName","searchHint","fetchOptions","replace","data","dispatch","registerInserterMediaCategory","labels","search_items","mediaType","getReportUrl","isExternalResource"],"sourceRoot":""}